{"version":3,"names":["defineComponent","provide","reactive","ref","onMounted","onBeforeUnmount","createUppyEventAdapter","UppyContextSymbol","Symbol","UppyContextProvider","name","props","uppy","type","Object","required","setup","_ref","slots","status","progress","uppyContext","uppyEventAdapter","Error","onStatusChange","newStatus","value","onProgressChange","newProgress","_uppyEventAdapter","cleanup","default"],"sources":["context-provider.ts"],"sourcesContent":["import {\n  defineComponent,\n  provide,\n  reactive,\n  ref,\n  onMounted,\n  onBeforeUnmount,\n} from 'vue'\nimport type { PropType } from 'vue'\nimport type Uppy from '@uppy/core'\nimport { createUppyEventAdapter } from '@uppy/components'\nimport type { UploadStatus } from '@uppy/components'\n\nexport interface UppyContext {\n  uppy: Uppy | undefined\n  status: UploadStatus\n  progress: number\n}\n\nexport const UppyContextSymbol = Symbol('uppy')\n\nexport const UppyContextProvider = defineComponent({\n  name: 'UppyContextProvider',\n  props: {\n    uppy: {\n      type: Object as PropType<Uppy>,\n      required: true,\n    },\n  },\n  setup(props, { slots }) {\n    const status = ref<UploadStatus>('init')\n    const progress = ref(0)\n\n    const uppyContext = reactive<UppyContext>({\n      uppy: props.uppy,\n      status: 'init',\n      progress: 0,\n    })\n\n    // Provide the context immediately instead of in onMounted\n    provide(UppyContextSymbol, uppyContext)\n\n    let uppyEventAdapter: ReturnType<typeof createUppyEventAdapter> | undefined\n\n    onMounted(() => {\n      if (!props.uppy) {\n        throw new Error(\n          'UppyContextProvider: passing `uppy` as a prop is required',\n        )\n      }\n\n      uppyEventAdapter = createUppyEventAdapter({\n        uppy: props.uppy,\n        onStatusChange: (newStatus: UploadStatus) => {\n          status.value = newStatus\n          uppyContext.status = newStatus\n        },\n        onProgressChange: (newProgress: number) => {\n          progress.value = newProgress\n          uppyContext.progress = newProgress\n        },\n      })\n    })\n\n    onBeforeUnmount(() => {\n      uppyEventAdapter?.cleanup()\n    })\n\n    return () => slots.default?.()\n  },\n})\n\nexport default UppyContextProvider\n"],"mappings":"AAAA,SACEA,eAAe,EACfC,OAAO,EACPC,QAAQ,EACRC,GAAG,EACHC,SAAS,EACTC,eAAe,QACV,KAAK;AAGZ,SAASC,sBAAsB,QAAQ,kBAAkB;AASzD,OAAO,MAAMC,iBAAiB,GAAGC,MAAM,CAAC,MAAM,CAAC;AAE/C,OAAO,MAAMC,mBAAmB,GAAGT,eAAe,CAAC;EACjDU,IAAI,EAAE,qBAAqB;EAC3BC,KAAK,EAAE;IACLC,IAAI,EAAE;MACJC,IAAI,EAAEC,MAAwB;MAC9BC,QAAQ,EAAE;IACZ;EACF,CAAC;EACDC,KAAKA,CAACL,KAAK,EAAAM,IAAA,EAAa;IAAA,IAAX;MAAEC;IAAM,CAAC,GAAAD,IAAA;IACpB,MAAME,MAAM,GAAGhB,GAAG,CAAe,MAAM,CAAC;IACxC,MAAMiB,QAAQ,GAAGjB,GAAG,CAAC,CAAC,CAAC;IAEvB,MAAMkB,WAAW,GAAGnB,QAAQ,CAAc;MACxCU,IAAI,EAAED,KAAK,CAACC,IAAI;MAChBO,MAAM,EAAE,MAAM;MACdC,QAAQ,EAAE;IACZ,CAAC,CAAC;;IAEF;IACAnB,OAAO,CAACM,iBAAiB,EAAEc,WAAW,CAAC;IAEvC,IAAIC,gBAAuE;IAE3ElB,SAAS,CAAC,MAAM;MACd,IAAI,CAACO,KAAK,CAACC,IAAI,EAAE;QACf,MAAM,IAAIW,KAAK,CACb,2DACF,CAAC;MACH;MAEAD,gBAAgB,GAAGhB,sBAAsB,CAAC;QACxCM,IAAI,EAAED,KAAK,CAACC,IAAI;QAChBY,cAAc,EAAGC,SAAuB,IAAK;UAC3CN,MAAM,CAACO,KAAK,GAAGD,SAAS;UACxBJ,WAAW,CAACF,MAAM,GAAGM,SAAS;QAChC,CAAC;QACDE,gBAAgB,EAAGC,WAAmB,IAAK;UACzCR,QAAQ,CAACM,KAAK,GAAGE,WAAW;UAC5BP,WAAW,CAACD,QAAQ,GAAGQ,WAAW;QACpC;MACF,CAAC,CAAC;IACJ,CAAC,CAAC;IAEFvB,eAAe,CAAC,MAAM;MAAA,IAAAwB,iBAAA;MACpB,CAAAA,iBAAA,GAAAP,gBAAgB,aAAhBO,iBAAA,CAAkBC,OAAO,CAAC,CAAC;IAC7B,CAAC,CAAC;IAEF,OAAO,MAAMZ,KAAK,CAACa,OAAO,oBAAbb,KAAK,CAACa,OAAO,CAAG,CAAC;EAChC;AACF,CAAC,CAAC;AAEF,eAAetB,mBAAmB","ignoreList":[]}